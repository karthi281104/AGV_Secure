<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reports - AGV Finance & Loans</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .reports-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 2rem;
            border-radius: 15px;
            color: white;
            margin-bottom: 2rem;
        }
        
        .report-card {
            background: #fff;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 1.5rem;
            margin-bottom: 2rem;
            transition: transform 0.3s ease;
        }
        
        .report-card:hover {
            transform: translateY(-5px);
        }
        
        .report-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            margin-bottom: 1rem;
        }
        
        .report-icon.loans {
            background: linear-gradient(135deg, #3498db, #2980b9);
        }
        
        .report-icon.customers {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
        }
        
        .report-icon.payments {
            background: linear-gradient(135deg, #f39c12, #e67e22);
        }
        
        .report-icon.financial {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }
        
        .report-icon.overdue {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
        }
        
        .report-icon.performance {
            background: linear-gradient(135deg, #1abc9c, #16a085);
        }
        
        .filter-section {
            background: #fff;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .chart-container {
            background: #fff;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 2rem;
            margin-bottom: 2rem;
        }
        
        .chart-canvas {
            max-height: 400px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stat-box {
            background: #fff;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            text-align: center;
            border-left: 4px solid;
        }
        
        .stat-box.primary {
            border-left-color: #3498db;
        }
        
        .stat-box.success {
            border-left-color: #2ecc71;
        }
        
        .stat-box.warning {
            border-left-color: #f39c12;
        }
        
        .stat-box.danger {
            border-left-color: #e74c3c;
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 0.5rem;
        }
        
        .stat-label {
            color: #6c757d;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }
        
        .stat-change {
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .stat-change.positive {
            color: #2ecc71;
        }
        
        .stat-change.negative {
            color: #e74c3c;
        }
        
        .export-buttons {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        
        .report-description {
            color: #6c757d;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-brand">
                <i class="fas fa-university"></i>
                <span>AGV Finance</span>
            </div>
            <div class="sidebar-subtitle">Employee Portal</div>
        </div>

        <div class="sidebar-nav">
            <a href="/dashboard" class="nav-link">
                <i class="fas fa-chart-pie"></i>
                <span>Dashboard</span>
            </a>
            <a href="/customers" class="nav-link">
                <i class="fas fa-users"></i>
                <span>Customers</span>
            </a>
            <a href="/loans" class="nav-link">
                <i class="fas fa-money-bill-wave"></i>
                <span>Loan Management</span>
            </a>
            <a href="/payments" class="nav-link">
                <i class="fas fa-hand-holding-usd"></i>
                <span>Payments</span>
            </a>
            <a href="/reports" class="nav-link active">
                <i class="fas fa-chart-bar"></i>
                <span>Reports</span>
            </a>
            <a href="/calculators/gold" class="nav-link">
                <i class="fas fa-calculator"></i>
                <span>Calculators</span>
            </a>
            <a href="/settings" class="nav-link">
                <i class="fas fa-cog"></i>
                <span>Settings</span>
            </a>
        </div>

        <div class="sidebar-footer">
            <div class="user-info">
                <img src="https://via.placeholder.com/40" alt="User" class="user-avatar">
                <div class="user-details">
                    <div class="user-name">Employee</div>
                    <div class="user-role">Loan Officer</div>
                </div>
            </div>
            <a href="/logout" class="logout-btn">
                <i class="fas fa-sign-out-alt"></i>
                <span>Logout</span>
            </a>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <button class="sidebar-toggle" id="sidebarToggle">
                    <i class="fas fa-bars"></i>
                </button>
                <h1 class="page-title">Reports & Analytics</h1>
            </div>

            <div class="header-right">
                <div class="user-menu">
                    <img src="https://via.placeholder.com/40" alt="User" class="user-avatar">
                    <span class="user-name">Employee</span>
                </div>
            </div>
        </header>

        <!-- Content -->
        <div class="content">
            <div class="container-fluid">
                <!-- Page Header -->
                <div class="reports-header">
                    <div class="row align-items-center">
                        <div class="col">
                            <h2 class="mb-1">Reports & Analytics</h2>
                            <p class="mb-0">Comprehensive business insights and data analytics</p>
                        </div>
                        <div class="col-auto">
                            <button class="btn btn-light" onclick="generateCustomReport()">
                                <i class="fas fa-plus me-2"></i>
                                Custom Report
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Filter Section -->
                <div class="filter-section">
                    <h5 class="mb-3">
                        <i class="fas fa-filter me-2"></i>
                        Report Filters
                    </h5>
                    <div class="row">
                        <div class="col-md-3">
                            <label class="form-label">Date Range</label>
                            <select class="form-select" id="dateRange">
                                <option value="today">Today</option>
                                <option value="week">This Week</option>
                                <option value="month" selected>This Month</option>
                                <option value="quarter">This Quarter</option>
                                <option value="year">This Year</option>
                                <option value="custom">Custom Range</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Report Type</label>
                            <select class="form-select" id="reportType">
                                <option value="all">All Reports</option>
                                <option value="loans">Loan Reports</option>
                                <option value="customers">Customer Reports</option>
                                <option value="financial">Financial Reports</option>
                                <option value="performance">Performance Reports</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Branch</label>
                            <select class="form-select" id="branchFilter">
                                <option value="all">All Branches</option>
                                <option value="head">Head Office</option>
                                <option value="branch1">Branch 1</option>
                                <option value="branch2">Branch 2</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">&nbsp;</label>
                            <div class="d-grid">
                                <button class="btn btn-primary" onclick="applyFilters()">
                                    <i class="fas fa-search me-1"></i>
                                    Apply Filters
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Key Statistics -->
                <div class="stats-grid">
                    <div class="stat-box primary">
                        <div class="stat-number" id="totalLoans">₹75.2M</div>
                        <div class="stat-label">Total Disbursed</div>
                        <div class="stat-change positive">
                            <i class="fas fa-arrow-up"></i> +8.3% from last month
                        </div>
                    </div>
                    <div class="stat-box success">
                        <div class="stat-number" id="activeLoans">387</div>
                        <div class="stat-label">Active Loans</div>
                        <div class="stat-change negative">
                            <i class="fas fa-arrow-down"></i> -2.1% from last month
                        </div>
                    </div>
                    <div class="stat-box warning">
                        <div class="stat-number" id="pendingPayments">₹12.3M</div>
                        <div class="stat-label">Pending Payments</div>
                        <div class="stat-change positive">
                            <i class="fas fa-arrow-up"></i> +5.7% from last month
                        </div>
                    </div>
                    <div class="stat-box danger">
                        <div class="stat-number" id="overdueLoans">23</div>
                        <div class="stat-label">Overdue Loans</div>
                        <div class="stat-change negative">
                            <i class="fas fa-arrow-down"></i> -15.2% from last month
                        </div>
                    </div>
                </div>

                <!-- Charts Section -->
                <div class="row">
                    <div class="col-lg-8">
                        <div class="chart-container">
                            <h5 class="mb-3">
                                <i class="fas fa-chart-line me-2"></i>
                                Monthly Disbursement Trend
                            </h5>
                            <canvas id="disbursementChart" class="chart-canvas"></canvas>
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <div class="chart-container">
                            <h5 class="mb-3">
                                <i class="fas fa-chart-pie me-2"></i>
                                Loan Types Distribution
                            </h5>
                            <canvas id="loanTypesChart" class="chart-canvas"></canvas>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-lg-6">
                        <div class="chart-container">
                            <h5 class="mb-3">
                                <i class="fas fa-chart-bar me-2"></i>
                                Payment Status Overview
                            </h5>
                            <canvas id="paymentStatusChart" class="chart-canvas"></canvas>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="chart-container">
                            <h5 class="mb-3">
                                <i class="fas fa-chart-area me-2"></i>
                                Customer Growth
                            </h5>
                            <canvas id="customerGrowthChart" class="chart-canvas"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Report Cards -->
                <h4 class="mb-4">Available Reports</h4>
                <div class="row">
                    <!-- Loan Reports -->
                    <div class="col-lg-4 col-md-6 mb-4">
                        <div class="report-card">
                            <div class="report-icon loans">
                                <i class="fas fa-money-bill-wave"></i>
                            </div>
                            <h5>Loan Reports</h5>
                            <p class="report-description">
                                Comprehensive loan analytics including disbursement, collections, and performance metrics.
                            </p>
                            <div class="export-buttons">
                                <button class="btn btn-outline-primary btn-sm" onclick="generateReport('loans', 'pdf')">
                                    <i class="fas fa-file-pdf me-1"></i> PDF
                                </button>
                                <button class="btn btn-outline-success btn-sm" onclick="generateReport('loans', 'excel')">
                                    <i class="fas fa-file-excel me-1"></i> Excel
                                </button>
                                <button class="btn btn-outline-info btn-sm" onclick="viewReport('loans')">
                                    <i class="fas fa-eye me-1"></i> View
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Customer Reports -->
                    <div class="col-lg-4 col-md-6 mb-4">
                        <div class="report-card">
                            <div class="report-icon customers">
                                <i class="fas fa-users"></i>
                            </div>
                            <h5>Customer Reports</h5>
                            <p class="report-description">
                                Detailed customer analytics, demographics, and relationship insights.
                            </p>
                            <div class="export-buttons">
                                <button class="btn btn-outline-primary btn-sm" onclick="generateReport('customers', 'pdf')">
                                    <i class="fas fa-file-pdf me-1"></i> PDF
                                </button>
                                <button class="btn btn-outline-success btn-sm" onclick="generateReport('customers', 'excel')">
                                    <i class="fas fa-file-excel me-1"></i> Excel
                                </button>
                                <button class="btn btn-outline-info btn-sm" onclick="viewReport('customers')">
                                    <i class="fas fa-eye me-1"></i> View
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Payment Reports -->
                    <div class="col-lg-4 col-md-6 mb-4">
                        <div class="report-card">
                            <div class="report-icon payments">
                                <i class="fas fa-hand-holding-usd"></i>
                            </div>
                            <h5>Payment Reports</h5>
                            <p class="report-description">
                                Payment tracking, collection efficiency, and outstanding balances analysis.
                            </p>
                            <div class="export-buttons">
                                <button class="btn btn-outline-primary btn-sm" onclick="generateReport('payments', 'pdf')">
                                    <i class="fas fa-file-pdf me-1"></i> PDF
                                </button>
                                <button class="btn btn-outline-success btn-sm" onclick="generateReport('payments', 'excel')">
                                    <i class="fas fa-file-excel me-1"></i> Excel
                                </button>
                                <button class="btn btn-outline-info btn-sm" onclick="viewReport('payments')">
                                    <i class="fas fa-eye me-1"></i> View
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Financial Reports -->
                    <div class="col-lg-4 col-md-6 mb-4">
                        <div class="report-card">
                            <div class="report-icon financial">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <h5>Financial Reports</h5>
                            <p class="report-description">
                                Revenue analysis, profit & loss statements, and financial performance indicators.
                            </p>
                            <div class="export-buttons">
                                <button class="btn btn-outline-primary btn-sm" onclick="generateReport('financial', 'pdf')">
                                    <i class="fas fa-file-pdf me-1"></i> PDF
                                </button>
                                <button class="btn btn-outline-success btn-sm" onclick="generateReport('financial', 'excel')">
                                    <i class="fas fa-file-excel me-1"></i> Excel
                                </button>
                                <button class="btn btn-outline-info btn-sm" onclick="viewReport('financial')">
                                    <i class="fas fa-eye me-1"></i> View
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Overdue Reports -->
                    <div class="col-lg-4 col-md-6 mb-4">
                        <div class="report-card">
                            <div class="report-icon overdue">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                            <h5>Overdue Reports</h5>
                            <p class="report-description">
                                Overdue loan tracking, risk assessment, and collection prioritization.
                            </p>
                            <div class="export-buttons">
                                <button class="btn btn-outline-primary btn-sm" onclick="generateReport('overdue', 'pdf')">
                                    <i class="fas fa-file-pdf me-1"></i> PDF
                                </button>
                                <button class="btn btn-outline-success btn-sm" onclick="generateReport('overdue', 'excel')">
                                    <i class="fas fa-file-excel me-1"></i> Excel
                                </button>
                                <button class="btn btn-outline-info btn-sm" onclick="viewReport('overdue')">
                                    <i class="fas fa-eye me-1"></i> View
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Performance Reports -->
                    <div class="col-lg-4 col-md-6 mb-4">
                        <div class="report-card">
                            <div class="report-icon performance">
                                <i class="fas fa-trophy"></i>
                            </div>
                            <h5>Performance Reports</h5>
                            <p class="report-description">
                                Employee performance metrics, productivity analysis, and KPI tracking.
                            </p>
                            <div class="export-buttons">
                                <button class="btn btn-outline-primary btn-sm" onclick="generateReport('performance', 'pdf')">
                                    <i class="fas fa-file-pdf me-1"></i> PDF
                                </button>
                                <button class="btn btn-outline-success btn-sm" onclick="generateReport('performance', 'excel')">
                                    <i class="fas fa-file-excel me-1"></i> Excel
                                </button>
                                <button class="btn btn-outline-info btn-sm" onclick="viewReport('performance')">
                                    <i class="fas fa-eye me-1"></i> View
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
    <script>
        // Initialize Charts
        document.addEventListener('DOMContentLoaded', function() {
            initializeCharts();
        });

        function initializeCharts() {
            // Disbursement Trend Chart
            const disbursementCtx = document.getElementById('disbursementChart').getContext('2d');
            new Chart(disbursementCtx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [{
                        label: 'Disbursements (₹ Lakhs)',
                        data: [45, 52, 48, 61, 58, 72],
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            // Loan Types Pie Chart
            const loanTypesCtx = document.getElementById('loanTypesChart').getContext('2d');
            new Chart(loanTypesCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Gold Loans', 'Personal Loans', 'Business Loans', 'Vehicle Loans'],
                    datasets: [{
                        data: [45, 25, 20, 10],
                        backgroundColor: ['#667eea', '#764ba2', '#f093fb', '#f5576c']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });

            // Payment Status Chart
            const paymentStatusCtx = document.getElementById('paymentStatusChart').getContext('2d');
            new Chart(paymentStatusCtx, {
                type: 'bar',
                data: {
                    labels: ['Paid', 'Pending', 'Overdue', 'Partial'],
                    datasets: [{
                        label: 'Count',
                        data: [245, 67, 23, 12],
                        backgroundColor: ['#2ecc71', '#f39c12', '#e74c3c', '#9b59b6']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            // Customer Growth Chart
            const customerGrowthCtx = document.getElementById('customerGrowthChart').getContext('2d');
            new Chart(customerGrowthCtx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [{
                        label: 'New Customers',
                        data: [23, 19, 31, 28, 35, 42],
                        borderColor: '#1abc9c',
                        backgroundColor: 'rgba(26, 188, 156, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function applyFilters() {
            const dateRange = document.getElementById('dateRange').value;
            const reportType = document.getElementById('reportType').value;
            const branch = document.getElementById('branchFilter').value;
            
            console.log('Applying filters:', { dateRange, reportType, branch });
            // Here you would make an API call to filter the data
            
            // Show loading indicator
            showToast('Applying filters...', 'info');
            
            // Simulate API call
            setTimeout(() => {
                showToast('Filters applied successfully!', 'success');
                // Refresh charts and data
            }, 1000);
        }

        function generateReport(type, format) {
            console.log(`Generating ${type} report in ${format} format`);
            showToast(`Generating ${type} report in ${format.toUpperCase()} format...`, 'info');
            
            // Simulate report generation
            setTimeout(() => {
                showToast(`${type} report generated successfully!`, 'success');
                // Here you would typically download the file or show a download link
            }, 2000);
        }

        function viewReport(type) {
            console.log(`Viewing ${type} report`);
            showToast(`Opening ${type} report...`, 'info');
            // Here you would open a detailed report view
        }

        function generateCustomReport() {
            showToast('Custom report builder coming soon!', 'info');
        }

        function showToast(message, type) {
            // Create a simple toast notification
            const toast = document.createElement('div');
            toast.className = `alert alert-${type} position-fixed`;
            toast.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
            toast.innerHTML = `
                ${message}
                <button type="button" class="btn-close" onclick="this.parentElement.remove()"></button>
            `;
            document.body.appendChild(toast);
            
            // Auto remove after 3 seconds
            setTimeout(() => {
                if (toast.parentElement) {
                    toast.remove();
                }
            }, 3000);
        }
    </script>
</body>
</html>