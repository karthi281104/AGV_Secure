<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reports - AGV Finance & Loans</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/universal-responsive.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.min.js"></script>
</head>
<body>
    <!-- Sidebar -->
    <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-brand">
                <i class="fas fa-university"></i>
                <span>AGV Finance</span>
            </div>
            <div class="sidebar-subtitle">Employee Portal</div>
        </div>

        <div class="sidebar-nav">
            <a href="/dashboard" class="nav-link">
                <i class="fas fa-chart-pie"></i>
                <span>Dashboard</span>
            </a>
            <a href="/customers" class="nav-link">
                <i class="fas fa-users"></i>
                <span>Customers</span>
            </a>
            <a href="/loans" class="nav-link">
                <i class="fas fa-money-bill-wave"></i>
                <span>Loan Management</span>
            </a>
            <a href="/payments" class="nav-link">
                <i class="fas fa-hand-holding-usd"></i>
                <span>Payments</span>
            </a>
            <a href="/reports" class="nav-link active">
                <i class="fas fa-chart-bar"></i>
                <span>Reports</span>
            </a>
            <a href="/calculators/gold" class="nav-link">
                <i class="fas fa-calculator"></i>
                <span>Calculators</span>
            </a>
            <a href="/settings" class="nav-link">
                <i class="fas fa-cog"></i>
                <span>Settings</span>
            </a>
        </div>

        <div class="sidebar-footer">
            <a href="/logout" class="nav-link logout-link">
                <i class="fas fa-sign-out-alt"></i>
                <span>Logout</span>
            </a>
        </div>
    </nav>

    <!-- Mobile Toggle -->
    <button class="mobile-toggle" id="mobileToggle" style="display: none;">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Header -->
        <header class="main-header">
            <div class="header-left">
                <button class="sidebar-toggle" id="sidebarToggle">
                    <i class="fas fa-bars"></i>
                </button>
                <h1 class="page-title">
                    <i class="fas fa-chart-line"></i>
                    Reports & Analytics
                </h1>
            </div>
            <div class="header-right">
                <span class="current-date" id="currentDate"></span>
            </div>
        </header>

        <!-- Reports Filter Section -->
        <div class="reports-filters">
            <div class="row">
                <div class="col-md-3">
                    <label class="form-label">Date Range</label>
                    <select class="form-select" id="dateRange">
                        <option value="today">Today</option>
                        <option value="week">This Week</option>
                        <option value="month" selected>This Month</option>
                        <option value="quarter">This Quarter</option>
                        <option value="year">This Year</option>
                        <option value="custom">Custom Range</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label class="form-label">From Date</label>
                    <input type="date" class="form-control" id="fromDate">
                </div>
                <div class="col-md-3">
                    <label class="form-label">To Date</label>
                    <input type="date" class="form-control" id="toDate">
                </div>
                <div class="col-md-3">
                    <label class="form-label">Report Type</label>
                    <select class="form-select" id="reportType">
                        <option value="all">All Reports</option>
                        <option value="loans">Loan Reports</option>
                        <option value="customers">Customer Reports</option>
                        <option value="financial">Financial Reports</option>
                    </select>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-md-12">
                    <button class="btn btn-primary" onclick="generateReports()">
                        <i class="fas fa-sync-alt"></i> Generate Reports
                    </button>
                    <button class="btn btn-success" onclick="exportReports()">
                        <i class="fas fa-download"></i> Export to Excel
                    </button>
                    <button class="btn btn-info" onclick="printReports()">
                        <i class="fas fa-print"></i> Print Reports
                    </button>
                </div>
            </div>
        </div>

        <!-- Key Metrics Cards -->
        <div class="row mb-4">
            <div class="col-xl-3 col-md-6 mb-3">
                <div class="metric-card">
                    <div class="metric-icon">
                        <i class="fas fa-hand-holding-usd"></i>
                    </div>
                    <div class="metric-info">
                        <h3 id="totalLoansAmount">â‚¹0</h3>
                        <p>Total Loans Disbursed</p>
                        <span class="metric-change positive" id="loansChange">+0%</span>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-md-6 mb-3">
                <div class="metric-card">
                    <div class="metric-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="metric-info">
                        <h3 id="totalCustomers">0</h3>
                        <p>Total Customers</p>
                        <span class="metric-change positive" id="customersChange">+0%</span>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-md-6 mb-3">
                <div class="metric-card">
                    <div class="metric-icon">
                        <i class="fas fa-percentage"></i>
                    </div>
                    <div class="metric-info">
                        <h3 id="averageInterest">0%</h3>
                        <p>Average Interest Rate</p>
                        <span class="metric-change neutral" id="interestChange">0%</span>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-md-6 mb-3">
                <div class="metric-card">
                    <div class="metric-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="metric-info">
                        <h3 id="monthlyGrowth">0%</h3>
                        <p>Monthly Growth</p>
                        <span class="metric-change positive" id="growthChange">+0%</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="row mb-4">
            <div class="col-xl-8 mb-4">
                <div class="chart-card">
                    <div class="chart-header">
                        <h4><i class="fas fa-chart-area"></i> Loan Disbursement Trend</h4>
                        <div class="chart-controls">
                            <button class="btn btn-sm btn-outline-primary" onclick="changeChartPeriod('week')">Week</button>
                            <button class="btn btn-sm btn-primary" onclick="changeChartPeriod('month')">Month</button>
                            <button class="btn btn-sm btn-outline-primary" onclick="changeChartPeriod('year')">Year</button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="loanTrendChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-xl-4 mb-4">
                <div class="chart-card">
                    <div class="chart-header">
                        <h4><i class="fas fa-chart-pie"></i> Loan Types Distribution</h4>
                    </div>
                    <div class="chart-container">
                        <canvas id="loanTypesChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Detailed Reports Tables -->
        <div class="row">
            <div class="col-12">
                <div class="report-tabs">
                    <ul class="nav nav-tabs" id="reportTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="loan-summary-tab" data-bs-toggle="tab" data-bs-target="#loan-summary" type="button" role="tab">
                                <i class="fas fa-hand-holding-usd"></i> Loan Summary
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="customer-analysis-tab" data-bs-toggle="tab" data-bs-target="#customer-analysis" type="button" role="tab">
                                <i class="fas fa-users"></i> Customer Analysis
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="financial-overview-tab" data-bs-toggle="tab" data-bs-target="#financial-overview" type="button" role="tab">
                                <i class="fas fa-chart-bar"></i> Financial Overview
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="performance-metrics-tab" data-bs-toggle="tab" data-bs-target="#performance-metrics" type="button" role="tab">
                                <i class="fas fa-tachometer-alt"></i> Performance Metrics
                            </button>
                        </li>
                    </ul>
                    <div class="tab-content" id="reportTabsContent">
                        <!-- Loan Summary Tab -->
                        <div class="tab-pane fade show active" id="loan-summary" role="tabpanel">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Loan Number</th>
                                            <th>Customer</th>
                                            <th>Amount</th>
                                            <th>Interest Rate</th>
                                            <th>Tenure</th>
                                            <th>Disbursed Date</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="loanSummaryTable">
                                        <tr class="loading-row">
                                            <td colspan="8" class="text-center">
                                                <div class="spinner-border spinner-border-sm" role="status"></div>
                                                Loading loan data...
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Customer Analysis Tab -->
                        <div class="tab-pane fade" id="customer-analysis" role="tabpanel">
                            <div class="row mb-3">
                                <div class="col-md-4">
                                    <div class="stat-card">
                                        <h5>New Customers</h5>
                                        <h3 class="text-primary" id="newCustomersCount">0</h3>
                                        <small class="text-muted">This month</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="stat-card">
                                        <h5>Active Customers</h5>
                                        <h3 class="text-success" id="activeCustomersCount">0</h3>
                                        <small class="text-muted">With active loans</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="stat-card">
                                        <h5>Average Loan Size</h5>
                                        <h3 class="text-info" id="averageLoanSize">â‚¹0</h3>
                                        <small class="text-muted">Per customer</small>
                                    </div>
                                </div>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Customer Name</th>
                                            <th>Total Loans</th>
                                            <th>Total Amount</th>
                                            <th>Last Loan Date</th>
                                            <th>Credit Score</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody id="customerAnalysisTable">
                                        <tr class="loading-row">
                                            <td colspan="6" class="text-center">
                                                <div class="spinner-border spinner-border-sm" role="status"></div>
                                                Loading customer data...
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Financial Overview Tab -->
                        <div class="tab-pane fade" id="financial-overview" role="tabpanel">
                            <div class="row mb-3">
                                <div class="col-md-3">
                                    <div class="stat-card">
                                        <h5>Total Portfolio</h5>
                                        <h3 class="text-primary" id="totalPortfolio">â‚¹0</h3>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="stat-card">
                                        <h5>Interest Earned</h5>
                                        <h3 class="text-success" id="totalInterest">â‚¹0</h3>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="stat-card">
                                        <h5>Outstanding Amount</h5>
                                        <h3 class="text-warning" id="outstandingAmount">â‚¹0</h3>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="stat-card">
                                        <h5>Collection Rate</h5>
                                        <h3 class="text-info" id="collectionRate">0%</h3>
                                    </div>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="financialOverviewChart"></canvas>
                            </div>
                        </div>

                        <!-- Performance Metrics Tab -->
                        <div class="tab-pane fade" id="performance-metrics" role="tabpanel">
                            <div class="performance-grid">
                                <div class="performance-card">
                                    <h5>Loan Approval Rate</h5>
                                    <div class="performance-value">
                                        <span class="value" id="approvalRate">0%</span>
                                        <span class="trend positive">â†— +2.5%</span>
                                    </div>
                                    <div class="progress">
                                        <div class="progress-bar bg-success" style="width: 0%" id="approvalRateBar"></div>
                                    </div>
                                </div>
                                <div class="performance-card">
                                    <h5>Average Processing Time</h5>
                                    <div class="performance-value">
                                        <span class="value" id="processingTime">0 days</span>
                                        <span class="trend negative">â†˜ -0.5 days</span>
                                    </div>
                                    <div class="progress">
                                        <div class="progress-bar bg-info" style="width: 0%" id="processingTimeBar"></div>
                                    </div>
                                </div>
                                <div class="performance-card">
                                    <h5>Customer Satisfaction</h5>
                                    <div class="performance-value">
                                        <span class="value" id="satisfaction">0%</span>
                                        <span class="trend positive">â†— +1.2%</span>
                                    </div>
                                    <div class="progress">
                                        <div class="progress-bar bg-warning" style="width: 0%" id="satisfactionBar"></div>
                                    </div>
                                </div>
                                <div class="performance-card">
                                    <h5>Default Rate</h5>
                                    <div class="performance-value">
                                        <span class="value" id="defaultRate">0%</span>
                                        <span class="trend positive">â†˜ -0.3%</span>
                                    </div>
                                    <div class="progress">
                                        <div class="progress-bar bg-danger" style="width: 0%" id="defaultRateBar"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner">
            <i class="fas fa-spinner fa-spin"></i>
            <p>Generating reports...</p>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/universal.js') }}"></script>
    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
    <script src="{{ url_for('static', filename='js/reports.js') }}"></script>
</body>
</html>
